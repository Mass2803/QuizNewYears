<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>New Year Quiz</title>

<style>
  body { font-family: Arial; background:#111; color:#fff; text-align:center; }
  button { padding:15px; margin:10px; font-size:18px; }
  .hidden { display:none; }
</style>
</head>

<body>

<h1>ðŸŽ‰ New Year Quiz ðŸŽ‰</h1>

<!-- ROLE -->
<div id="roleScreen">
  <button onclick="setRole('master')">Quiz Master</button>
  <button onclick="setRole('player')">Player</button>
</div>

<!-- VOTING -->
<div id="voteScreen" class="hidden">
  <h2>Vote what to do</h2>
  <button onclick="sendVote('Quiz')">Quiz</button>
  <button onclick="sendVote('Games')">Games</button>
  <button onclick="sendVote('Music')">Music</button>
  <p id="voteMsg"></p>
</div>

<!-- MASTER -->
<div id="masterScreen" class="hidden">
  <h2>Live Votes</h2>
  <div id="results"></div>
  <button onclick="endVoting()">TIMEâ€™S UP</button>
  <button onclick="nextQuestion()">Next Question</button>
</div>

<!-- QUIZ -->
<div id="quizScreen" class="hidden">
  <h2 id="questionText"></h2>
  <div id="answers"></div>
  <p id="quizMsg"></p>
</div>

<script>
/* ðŸ”´ PUT YOUR NEW /exec URL HERE ðŸ”´ */
const API = ". . .";

/* QUESTIONS */
const questions = [
  {
    q: "What year are we entering?",
    a: ["2024", "2025", "2026", "2030"],
    correct: 1
  },
  {
    q: "Which country sees New Year first?",
    a: ["USA", "UK", "Japan", "New Zealand"],
    correct: 3
  },
  {
    q: "What drink is traditional for New Year?",
    a: ["Beer", "Wine", "Champagne", "Vodka"],
    correct: 2
  }
];

let currentQuestion = 0;

/* ROLE */
function setRole(role) {
  localStorage.role = role;
  document.getElementById("roleScreen").classList.add("hidden");
  document.getElementById("voteScreen").classList.remove("hidden");
  if (role === "master") {
    document.getElementById("masterScreen").classList.remove("hidden");
  }
}

/* VOTE */
function sendVote(option) {
  if (localStorage.voted) {
    document.getElementById("voteMsg").innerText = "Already voted";
    return;
  }
  fetch(`${API}?action=vote&option=${encodeURIComponent(option)}`);
  localStorage.voted = "true";
  document.getElementById("voteMsg").innerText = "Vote sent ðŸŽ‰";
}

/* END VOTE */
function endVoting() {
  fetch(`${API}?action=setMode&mode=quiz`);
}

/* QUIZ */
function loadQuestion() {
  localStorage.removeItem("answered");
  document.getElementById("quizMsg").innerText = "";

  const q = questions[currentQuestion];
  document.getElementById("questionText").innerText = q.q;

  const answers = document.getElementById("answers");
  answers.innerHTML = "";

  q.a.forEach((text, i) => {
    const btn = document.createElement("button");
    btn.innerText = text;
    btn.onclick = () => answer(i);
    answers.appendChild(btn);
  });
}

function answer(choice) {
  if (localStorage.answered) return;
  localStorage.answered = "true";

  if (choice === questions[currentQuestion].correct) {
    document.getElementById("quizMsg").innerText = "âœ… Correct!";
  } else {
    document.getElementById("quizMsg").innerText = "âŒ Wrong!";
  }
}

function nextQuestion() {
  currentQuestion++;
  if (currentQuestion >= questions.length) {
    alert("Quiz finished ðŸŽ‰");
    return;
  }
  loadQuestion();
}

/* POLL */
function poll() {
  fetch(API)
    .then(r => r.json())
    .then(d => {
      let out = "";
      for (let k in d.votes) out += `<p>${k}: ${d.votes[k]}</p>`;
      document.getElementById("results").innerHTML = out;

      if (d.mode === "quiz") {
        document.getElementById("voteScreen").classList.add("hidden");
        document.getElementById("quizScreen").classList.remove("hidden");
        loadQuestion();
      }
    });
}

setInterval(poll, 2000);
</script>

</body>
</html>


