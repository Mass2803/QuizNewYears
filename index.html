<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Party Vote</title>

<style>
body { font-family: Arial; text-align: center; background:#111; color:#fff; }
button { padding:15px; margin:10px; font-size:18px; }
.hidden { display:none; }
</style>
</head>

<body>

<h1>ðŸŽ‰ Party Vote ðŸŽ‰</h1>

<div id="role">
  <button onclick="setRole('master')">Quiz Master</button>
  <button onclick="setRole('player')">Player</button>
</div>

<div id="vote" class="hidden">
  <h2>Vote what to do</h2>
  <button onclick="vote('Quiz')">Quiz</button>
  <button onclick="vote('Games')">Games</button>
  <button onclick="vote('Music')">Music</button>
  <p id="msg"></p>
</div>

<div id="master" class="hidden">
  <h2>Live Results</h2>
  <div id="results">Waitingâ€¦</div>
  <button onclick="endVote()">TIMEâ€™S UP</button>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzz2B4D3wBgDG-AP5QhYXNhLB5eP0UG4VlasK2CvIVShJR_BMfF9K2bszLDgLDrgNMX8w/exec";

function setRole(r) {
  localStorage.role = r;
  document.getElementById("role").classList.add("hidden");
  document.getElementById("vote").classList.remove("hidden");
  if (r === "master") document.getElementById("master").classList.remove("hidden");
}

function vote(option) {
  if (localStorage.voted) {
    document.getElementById("msg").innerText = "Already voted";
    return;
  }

  fetch(`${API}?action=vote&option=${encodeURIComponent(option)}`);
  localStorage.voted = "true";
  document.getElementById("msg").innerText = "Vote sent ðŸŽ‰";
}

function endVote() {
  fetch(`${API}?action=setMode&mode=quiz`);
}

function poll() {
  fetch(API)
    .then(r => r.json())
    .then(d => {
      let out = "";
      for (let k in d.votes) out += `<p>${k}: ${d.votes[k]}</p>`;
      document.getElementById("results").innerHTML = out || "No votes yet";

      if (d.mode === "quiz") {
        document.getElementById("vote").classList.add("hidden");
      }
    });
}

setInterval(poll, 2000);
</script>

</body>
</html>
